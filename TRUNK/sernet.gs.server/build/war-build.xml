<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     15.03.2010 15:06:19                                                        

     verinice    
     ant buildfile to create a war file
                   
     author: Daniel Murygin - dm[at]sernet[dot]de                                                         
     ====================================================================== -->
<project name="verinice" default="war" basedir="../">
    <description>
            ant buildfile to create a war file
    </description>

    <!-- ================================= 
          target: war              
         ================================= -->	
    <target name="war" depends="copy-jars" description="creates a war file">
		<property name="destination" location="${sp:destination}"/>
        <war destfile="${destination}/${filename}" webxml="WebContent/WEB-INF/web.xml">
        	<fileset dir="WebContent">
        		<exclude name="WEB-INF/web.xml"/>
        		<exclude name="WEB-INF/web-light.xml"/>
        	</fileset>
        	<zipfileset dir="bin" prefix="WEB-INF/classes">
        		<exclude name="log4j-dev.xml"/>
        		<exclude name="log4j-prod.xml"/>
        	</zipfileset>
        </war>
    </target>
	
	<!-- ================================= 
	          target: war-no-web              
	         ================================= -->
	<target name="war-light" depends="copy-jars" description="creates a war file">
		<property name="destination" location="${sp:destination}"/>
		<echo message="Creating ${destination}/${filename}..."/>
        <war destfile="${destination}/${filename}" webxml="WebContent/WEB-INF/web-light.xml">
        	<fileset dir="WebContent">
    			<exclude name="WEB-INF/web.xml"/>
    			<exclude name="WEB-INF/web-light.xml"/>
        		<exclude name="**/*.xhtml"/>
        		<exclude name="todo"/>
        		<exclude name="template"/>
        	</fileset>
        	<zipfileset dir="bin" prefix="WEB-INF/classes">
        		<exclude name="log4j-dev.xml"/>
        		<exclude name="log4j-prod.xml"/>
        	</zipfileset>
        </war>
	</target>
	
	<!-- ================================= 
	      target: war-local              
	     ================================= -->
    <target name="war-local" description="creates a war file">
		<property name="destination" location="${sp:destination}"/>
        <war destfile="${destination}/${filename}" webxml="WebContent/WEB-INF/web.xml">
        	<fileset dir="WebContent">
        		<exclude name="WEB-INF/web.xml"/>
        		<exclude name="WEB-INF/web-light.xml"/>
        	</fileset>
        	<zipfileset dir="bin" prefix="WEB-INF/classes">       		
        		<exclude name="log4j-dev.xml"/>
        		<exclude name="log4j-prod.xml"/>
        	</zipfileset>
        </war>
    </target>

	<!-- ================================= 
          target: copy-jars              
         ================================= -->
	<target name="copy-jars" description="copies al releavant jar file to WEB-INF/lib">
		<property name="destination" location="${sp:destination}"/>
		<!-- delete old versions -->
		<delete>
			<fileset dir="${basedir}/WebContent/WEB-INF/lib/" includes="sernet.*.jar"/>
		</delete>
		<!-- copy current version to WEB-INF/lib -->
		<copy todir="${basedir}/WebContent/WEB-INF/lib" flatten="true">
			<fileset dir="${destination}/../">
			  <!-- includes -->
			  <include name="sernet.hui.common*.*/jar/sernet.hui.common*.jar"/>
			  <include name="sernet.hui.swtclient*.*/jar/sernet.hui.swtclient*.jar"/>
			  <include name="sernet.hui.server*.*/jar/sernet.hui.server*.jar"/>
			  <include name="sernet.gs.ui.rcp.main*.*/jar/sernet.gs.ui.rcp.main*.jar"/>
			  <include name="sernet.gs.service*.*/jar/sernet.gs.service*.jar"/>
			  <include name="sernet.gs.reveng*.*/jar/sernet.gs.reveng*.jar"/>
			  <include name="sernet.verinice.samt.service*.*/jar/sernet.verinice.samt.service*.jar"/>
			  <!-- excludes -->	  
			  <exclude name="sernet.gs.ui.rcp.main.feature*.*/jar/sernet.gs.ui.rcp.main.feature*.jar"/>
			</fileset>
		</copy>
	</target>

</project>
